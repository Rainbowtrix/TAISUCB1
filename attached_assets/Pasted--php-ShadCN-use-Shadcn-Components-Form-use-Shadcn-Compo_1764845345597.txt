<?php
// Подключаем компоненты из ShadCN

use Shadcn\Components\Form;
use Shadcn\Components\Button;
use Shadcn\Components\Select;
use Shadcn\Components\Dialog;
use Shadcn\Components\Table;
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Форма рейса с Документами</title>
    <link href="https://cdn.jsdelivr.net/npm/shadcn-ui@1.0.0-beta.1/dist/css/shadcn.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; background:#f6f7f6; color:#1f2d1f; margin:0; padding:0; }
        .container{ max-width:1300px; margin:20px auto; padding:20px; background:white; border-radius:16px; box-sizing:border-box; }
        h2{ margin-top:20px; color:#0c4f24; }
        .row{ display:flex; flex-wrap:wrap; gap:20px; margin-bottom:20px; }
        .field{ flex:1; display:flex; flex-direction:column; min-width:180px; }
        label{ font-size:14px; margin-bottom:4px; color:#0c4f24; }
        input, select{ padding:8px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; }

        table{ width:100%; margin-top:20px; border-collapse:collapse; }
        th, td{ border:1px solid #ccc; padding:8px; text-align:left; }
        th{ background:#e7f3ea; color:#0c4f24; }
        td{ background:#f9f9f9; }
    </style>
</head>
<body>
<div class="container">
    <!-- Ссылка "Вид для клиента" выровнена по верхнему краю -->
    <div class="top-link-container">
        <a href="#" onclick="openClientView()">Вид для клиента</a>
    </div>

    <h2>Данные рейса</h2>
    <div class="row">
        <div class="field">
            <label>ID рейса</label>
            <?php echo Form::text('RideID', '25Ext210334', ['readonly' => true]); ?>
        </div>
        <div class="field">
            <label>Номер авто/сцепки</label>
            <?php echo Form::text('EquipmentNumber', 'K509OA/AM4918', ['readonly' => true]); ?>
        </div>
        <div class="field">
            <label>Дата въезда</label>
            <?php echo Form::text('EntranceDate', '2025-12-03 09:30', ['readonly' => true]); ?>
        </div>
        <div class="field">
            <label>Статус рейса</label>
            <?php echo Form::text('RideStatus', 'Одобрено к отправке', ['readonly' => true]); ?>
        </div>
        <div class="field">
            <label>Бизнес-единица</label>
            <?php echo Form::text('AreaId', 'AFR', ['readonly' => true]); ?>
        </div>
        <div class="field">
            <label>Услуги таможенного брокера</label>
            <?php
            echo Select::create('BrokerServices', [
                'yes' => 'Да',
                'no' => 'Нет'
            ]);
            ?>
        </div>
    </div>

    <h2>Грузы</h2>
    <?php
    // Используем компонент для таблицы
    echo Table::create([
        'columns' => ['Груз', 'Номер накладной (CMR или ТТН)', 'Дата накладной', 'Номер ДТ', 'Договор', 'ID компании', 'Наименование компании', 'ID ТБО', 'Наименование ТБО', 'Статус'],
        'rows' => [
            ['25ТАИ003028', '0110', '2025-12-01', '10009100/291025/5352481', '0235/ФЛ', 'ВЕРТЕКС', 'ООО "ВЕРТЕКС"', 'ТБ_Авто', 'ТБ_Авто', 'Завершено'],
            ['25ТАИ003029', 'М-304886', '2025-12-03', '10009100/291025/5352482', '0227/ФЛ', 'ВЕРТЕКС', 'ООО "ВЕРТЕКС"', 'ТБ_Авто', 'ТБ_Авто', 'На хранении'],
            ['25ТАИ003030', 'М-304886', '2025-12-03', '10009100/291025/5352483', '0227/ФЛ', 'ВЕРТЕКС', 'ООО "ВЕРТЕКС"', 'ТБ_Авто', 'ТБ_Авто', 'Частично отгружено']
        ]
    ]);
    ?>

    <h2>Операции на СВХ</h2>
    <?php
    // Операции на СВХ
    echo Table::create([
        'columns' => ['Наименование работ', 'Дата услуги', 'Кол-во', 'Номер накладной (CMR или ТТН)', 'Договор', 'Наименование компании'],
        'rows' => [
            ['Погрузо-разгрузочные работы', '2025-12-01', '10,00', 'М-304886', '0227/ФЛ', 'ООО "ВЕРТЕКС"'],
            ['Сортировочные работы', '2025-12-02', '50,00', 'М-304886', '0227/ФЛ', 'ООО "ВЕРТЕКС"'],
            ['Хранение груза', '2025-12-03', '200,00', 'М-304886', '0227/ФЛ', 'ООО "ВЕРТЕКС"'],
            ['Оформление документов', '2025-12-04', '25,00', '0110', '0235/ФЛ', 'ООО "ВЕРТЕКС"']
        ]
    ]);
    ?>

    <h2>Документы</h2>
    <div style="margin-bottom:10px;">
        <span><a href="#">Добавить документ</a> | <a href="#" onclick="openModal('deleteAll')">Скачать все</a> | <a href="#" onclick="openModal('deleteAll')">Удалить все</a></span>
    </div>
    <table>
        <thead>
            <tr>
                <th>Тип</th><th>Файл</th><th>Дата/Время</th><th>Размер файла</th><th>Пользователь</th><th>Действия</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>CMR</td><td><a href="#" onclick="openPreview('cmr_001.pdf')">ООО "ВЕРТЕКС"-25Ext210334-M-304886.pdf</a></td><td>2025-12-01 10:00</td><td>1,2 MB</td><td>Иванов И.И.</td>
                <td>
                    <a href="#">Скачать</a> | <a href="#">Удалить</a>
                </td>
            </tr>
            <tr>
                <td>ТТН</td><td><a href="#" onclick="openPreview('ttn_001.jpg')">ООО "ВЕРТЕКС"-25Ext210334-0110.jpg</a></td><td>2025-12-01 11:00</td><td>0,8 MB</td><td>Петров П.П.</td>
                <td>
                    <a href="#">Скачать</a> | <a href="#">Удалить</a>
                </td>
            </tr>
            <tr>
                <td>ДТ</td><td><a href="#" onclick="openPreview('dt_001.docx')">ООО "ВЕРТЕКС"-25Ext210334-10009100/291025/5352483.pdf</a></td><td>2025-12-02 09:30</td><td>0,5 MB</td><td>Сидоров С.С.</td>
                <td>
                    <a href="#">Скачать</a> | <a href="#">Удалить</a>
                </td>
            </tr>
            <tr>
                <td>Комплект документов</td><td><a href="#" onclick="openPreview('contract_001.zip')">ООО "ВЕРТЕКС"-25Ext210334.zip</a></td><td>2025-12-02 12:00</td><td>1,5 MB</td><td>Кузнецов К.К.</td>
                <td>
                    <a href="#">Скачать</a> | <a href="#">Удалить</a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Модальные окна -->
<div id="modal" class="modal">
    <div class="modal-content" id="modalContent">
        <div class="modal-header" id="modalTitle"></div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-buttons" id="modalButtons"></div>
    </div>
</div>

<script>
    function openModal(type) {
        const modal = document.getElementById('modal');
        const title = document.getElementById('modalTitle');
        const body = document.getElementById('modalBody');
        const buttons = document.getElementById('modalButtons');
        buttons.innerHTML = '';

        if(type==='delete'){
            title.innerText = 'Удаление документа';
            body.innerText = 'Вы уверены, что хотите удалить документ?';
            buttons.innerHTML = '<button onclick="closeModal()">Нет</button><button onclick="closeModal()">Да</button>';
        } else if(type==='deleteAll'){
            const totalFiles = 4; // Example count of files
            const totalSize = "4,0 MB"; // Example total size
            title.innerText = 'Удаление всех документов';
            body.innerText = `Вы собираетесь удалить ${totalFiles} файлов, общий размер ${totalSize}. Подтвердить/Отменить`;
            buttons.innerHTML = '<button onclick="closeModal()">Отменить</button><button onclick="closeModal()">Подтвердить</button>';
        } else if(type==='view'){
            title.innerText = 'Просмотр документа';
            body.innerText = 'Здесь будет просмотр документа';
            buttons.innerHTML = '<button onclick="closeModal()">Закрыть</button>';
        } else if(type==='download'){
            title.innerText = 'Скачать документ';
            body.innerText = 'Скачать документ?';
            buttons.innerHTML = '<button onclick="closeModal()">Нет</button><button onclick="closeModal()">Да</button>';
        } else if(type==='add'){
            title.innerText = 'Добавить документ';
            body.innerHTML = '<label>Имя файла: <input type="file"></label><br><label>Тип документа: <input type="text"></label>';
            buttons.innerHTML = '<button onclick="closeModal()">Отмена</button><button onclick="closeModal()">Добавить</button>';
        }

        modal.style.display = 'block';
    }

    function closeModal(){
        document.getElementById('modal').style.display='none';
    }

    function openClientView() {
        window.location.href = "#"; // Replace with the actual link to the "Client View"
    }

    function openPreview(fileName) {
        alert("Просмотр документа: " + fileName); // Actual document preview logic should be implemented here
    }

    window.onclick = function(event){
        const modal = document.getElementById('modal');
        if(event.target == modal){
            modal.style.display='none';
        }
    }
</script>
</body>
</html>
